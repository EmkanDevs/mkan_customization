{
    "creation": "2025-12-03 08:40:00.000000",
    "docstatus": 0,
    "doctype": "Custom HTML Block",
    "html": "<div id=\"custom-notification-workspace\">\n  <div class=\"notification-workspace-header\">\n    <h3>My Notifications</h3>\n    <button class=\"btn btn-sm btn-primary\" id=\"mark-all-read-btn\">\n      <svg class=\"icon icon-sm\"><use href=\"#icon-tick\"></use></svg>\n      Mark All as Read\n    </button>\n  </div>\n  \n  <div class=\"notification-filters\">\n    <button class=\"btn btn-xs filter-btn active\" data-type=\"all\">All</button>\n    <button class=\"btn btn-xs filter-btn\" data-type=\"Mention\">Mentions</button>\n    <button class=\"btn btn-xs filter-btn\" data-type=\"Assignment\">Assignments</button>\n    <button class=\"btn btn-xs filter-btn\" data-type=\"Share\">Shares</button>\n    <button class=\"btn btn-xs filter-btn\" data-type=\"Alert\">Alerts</button>\n    <button class=\"btn btn-xs filter-btn\" data-type=\"Energy Point\">Energy Points</button>\n  </div>\n  \n  <div class=\"notification-container\" id=\"notification-list\">\n    <div class=\"text-center text-muted\" style=\"padding: 40px;\">\n      <div class=\"spinner-border\" role=\"status\"></div>\n      <p class=\"mt-3\">Loading notifications...</p>\n    </div>\n  </div>\n</div>",
    "idx": 0,
    "modified": "2025-12-03 08:40:00.000000",
    "modified_by": "Administrator",
    "module": "mkan_customization",
    "name": "notification_list",
    "owner": "Administrator",
    "private": 0,
    "script": "(function() {\n  let allNotifications = [];\n  let currentFilter = 'all';\n  \n  function loadNotifications() {\n    frappe.call({\n      method: 'frappe.desk.doctype.notification_log.notification_log.get_notification_logs',\n      args: { limit: 100 },\n      callback: function(r) {\n        if (r.message) {\n          allNotifications = r.message.notification_logs || [];\n          frappe.update_user_info(r.message.user_info);\n          renderNotifications();\n        }\n      }\n    });\n  }\n  \n  function renderNotifications() {\n    const container = root_element.querySelector('#notification-list');\n    if (!container) return;\n    \n    let notifications = allNotifications;\n    if (currentFilter !== 'all') {\n      notifications = allNotifications.filter(n => n.type === currentFilter);\n    }\n    \n    if (notifications.length === 0) {\n      container.innerHTML = `\n        <div class='empty-state'>\n          <svg class='icon icon-xl'><use href='#icon-notification'></use></svg>\n          <h4>No Notifications</h4>\n          <p>You don't have any ${currentFilter === 'all' ? '' : currentFilter.toLowerCase()} notifications yet.</p>\n        </div>\n      `;\n      return;\n    }\n    \n    let html = '';\n    notifications.forEach(notif => {\n      const readClass = notif.read ? '' : 'unread';\n      const timestamp = frappe.datetime.comment_when(notif.creation);\n      const userAvatar = frappe.avatar(notif.from_user, 'avatar-medium');\n      const docLink = getDocLink(notif);\n      const typeBadge = notif.type ? `<span class='notification-type-badge'>${notif.type}</span>` : '';\n      \n      html += `\n        <div class='notification-item ${readClass}' data-name='${notif.name}' data-link='${docLink}'>\n          <div class='notification-content'>\n            ${userAvatar}\n            <div class='notification-message'>\n              <div class='subject'>${notif.subject}</div>\n              <div class='timestamp'>${timestamp} ${typeBadge}</div>\n            </div>\n          </div>\n          <div class='notification-actions'>\n            ${!notif.read ? \"<button class='btn btn-xs btn-secondary mark-read-btn' onclick='event.stopPropagation();' title='Mark as Read'><svg class='icon icon-xs'><use href='#icon-tick'></use></svg></button>\" : ''}\n          </div>\n        </div>\n      `;\n    });\n    \n    container.innerHTML = html;\n    bindEvents();\n  }\n  \n  function getDocLink(notif) {\n    if (notif.link) return notif.link;\n    if (notif.document_type && notif.document_name) {\n      return frappe.utils.get_form_link(notif.document_type, notif.document_name);\n    }\n    return '#';\n  }\n  \n  function bindEvents() {\n    // Mark individual as read\n    root_element.querySelectorAll('.mark-read-btn').forEach(btn => {\n      btn.addEventListener('click', function(e) {\n        e.stopPropagation();\n        const item = this.closest('.notification-item');\n        const docname = item.dataset.name;\n        markAsRead(docname, item);\n      });\n    });\n    \n    // Click notification to navigate\n    root_element.querySelectorAll('.notification-item').forEach(item => {\n      item.addEventListener('click', function() {\n        const link = this.dataset.link;\n        const docname = this.dataset.name;\n        const isUnread = this.classList.contains('unread');\n        \n        if (isUnread) {\n          markAsRead(docname);\n        }\n        \n        if (link && link !== '#') {\n          frappe.set_route(link.replace('/app/', '').split('/'));\n        }\n      });\n    });\n  }\n  \n  function markAsRead(docname, element) {\n    frappe.call({\n      method: 'frappe.desk.doctype.notification_log.notification_log.mark_as_read',\n      args: { docname: docname },\n      callback: function() {\n        if (element) {\n          element.classList.remove('unread');\n          element.querySelector('.mark-read-btn')?.remove();\n        }\n        const notif = allNotifications.find(n => n.name === docname);\n        if (notif) notif.read = 1;\n      }\n    });\n  }\n  \n  function markAllAsRead() {\n    frappe.call({\n      method: 'frappe.desk.doctype.notification_log.notification_log.mark_all_as_read',\n      callback: function() {\n        frappe.show_alert({\n          message: __('All notifications marked as read'),\n          indicator: 'green'\n        });\n        loadNotifications();\n      }\n    });\n  }\n  \n  // Filter buttons\n  root_element.querySelectorAll('.filter-btn').forEach(btn => {\n    btn.addEventListener('click', function() {\n      root_element.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));\n      this.classList.add('active');\n      currentFilter = this.dataset.type;\n      renderNotifications();\n    });\n  });\n  \n  // Mark all as read button\n  const markAllBtn = root_element.querySelector('#mark-all-read-btn');\n  if (markAllBtn) {\n    markAllBtn.addEventListener('click', markAllAsRead);\n  }\n  \n  // Real-time updates\n  frappe.realtime.on('notification', function() {\n    frappe.show_alert({\n      message: __('New notification received'),\n      indicator: 'blue'\n    });\n    loadNotifications();\n  });\n  \n  // Initial load\n  loadNotifications();\n})();",
    "style": "#custom-notification-workspace {\n  padding: 20px;\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\n.notification-workspace-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n  padding-bottom: 15px;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.notification-workspace-header h3 {\n  margin: 0;\n  font-weight: 600;\n}\n\n.notification-filters {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 20px;\n  flex-wrap: wrap;\n}\n\n.filter-btn {\n  border: 1px solid var(--border-color);\n  background: white;\n  transition: all 0.2s;\n}\n\n.filter-btn:hover {\n  background: var(--fg-hover-color);\n}\n\n.filter-btn.active {\n  background: var(--primary-color);\n  color: white;\n  border-color: var(--primary-color);\n}\n\n.notification-container {\n  background: white;\n  border-radius: var(--border-radius-md);\n  border: 1px solid var(--border-color);\n}\n\n.notification-item {\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color);\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  transition: background 0.2s;\n  cursor: pointer;\n}\n\n.notification-item:last-child {\n  border-bottom: none;\n}\n\n.notification-item:hover {\n  background: var(--fg-hover-color);\n}\n\n.notification-item.unread {\n  background: var(--bg-blue);\n  border-left: 3px solid var(--primary-color);\n}\n\n.notification-content {\n  display: flex;\n  gap: 12px;\n  flex: 1;\n  align-items: flex-start;\n}\n\n.notification-message {\n  flex: 1;\n}\n\n.notification-message .subject {\n  margin-bottom: 5px;\n  line-height: 1.5;\n}\n\n.notification-message .timestamp {\n  font-size: var(--text-xs);\n  color: var(--text-muted);\n}\n\n.notification-actions {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n}\n\n.notification-type-badge {\n  display: inline-block;\n  padding: 2px 8px;\n  border-radius: 12px;\n  font-size: var(--text-xs);\n  font-weight: 500;\n  background: var(--bg-light-gray);\n  color: var(--text-muted);\n}\n\n.empty-state {\n  text-align: center;\n  padding: 60px 20px;\n  color: var(--text-muted);\n}\n\n.empty-state svg {\n  width: 100px;\n  height: 100px;\n  opacity: 0.3;\n  margin-bottom: 20px;\n}"
}